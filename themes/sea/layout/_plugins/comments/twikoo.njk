<div id="tcomment" class="sea-page-card-wrapper"></div>
<script>
  (function() {
    const initTwikoo = () => {
      const script = document.createElement('script');
      script.src = 'https://cdn.jsdelivr.net/npm/twikoo@1.6.39/dist/twikoo.all.min.js';
      script.async = true;
      script.onload = () => {
        twikoo.init({
          envId: '{{ theme.twikoo.envId }}',
          el: '#tcomment',
          lang: '{{ theme.twikoo.lang | default("zh-CN") }}',
          region: '{{ theme.twikoo.region }}',
          path: '{{ theme.twikoo.path | default(url_for(page.path)) }}'
        }).catch(err => {
          console.error('[TWIKOO] Init Error:', err);
        });
      };
      document.body.appendChild(script);
    };

    const observer = new IntersectionObserver((entries) => {
      if (entries[0].isIntersecting) {
        initTwikoo();
        observer.disconnect();
      }
    }, { threshold: 0 });

    const el = document.getElementById('tcomment');
    if (el) {
      observer.observe(el);
    }
  })();
</script>
